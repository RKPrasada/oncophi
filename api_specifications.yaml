```yaml
openapi: 3.0.3
info:
  title: Retail Multi-Tenant SaaS API
  description: |
    RESTful API for managing users, products, orders, shipments, inventory, and categories.
    Implements OAuth2 JWT authentication with role-based access control.
    Supports file upload for product images and PDF invoice downloads.
  version: "1.0.0"
servers:
  - url: https://api.example.com/api/v1
    description: Production server (v1)
tags:
  - name: Auth
    description: Authentication and user session management
  - name: Users
    description: User registration and profile management
  - name: Products
    description: Product catalog management
  - name: Orders
    description: Customer order management
  - name: Shipments
    description: Shipment tracking and management
  - name: Inventory
    description: Inventory level management
  - name: Categories
    description: Product category management

components:
  securitySchemes:
    OAuth2PasswordBearer:
      type: oauth2
      flows:
        password:
          tokenUrl: /api/v1/auth/login
          scopes: {}
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              example: INVALID_REQUEST
            message:
              type: string
              example: Validation failed for the request
            details:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                    example: email
                  issue:
                    type: string
                    example: must be a valid email address
      required:
        - error

    UserBase:
      type: object
      properties:
        userId:
          type: string
          format: uuid
          readOnly: true
        name:
          type: string
          example: John Doe
        email:
          type: string
          format: email
          example: john@example.com
        role:
          type: string
          enum: [Admin, Manager, Customer]
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - name
        - email
        - role

    UserCreate:
      type: object
      properties:
        name:
          type: string
          example: John Doe
        email:
          type: string
          format: email
          example: john@example.com
        password:
          type: string
          format: password
          minLength: 8
        role:
          type: string
          enum: [Admin, Manager, Customer]
      required:
        - name
        - email
        - password
        - role

    UserLoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: john@example.com
        password:
          type: string
          format: password
      required:
        - email
        - password

    UserLoginResponse:
      type: object
      properties:
        access_token:
          type: string
          description: JWT access token
        refresh_token:
          type: string
          description: Refresh token for session continuation
        token_type:
          type: string
          example: bearer
      required:
        - access_token
        - refresh_token
        - token_type

    ProductBase:
      type: object
      properties:
        productId:
          type: string
          format: uuid
          readOnly: true
        name:
          type: string
          example: Running Shoes
        description:
          type: string
          example: Comfortable running shoes
        SKU:
          type: string
          example: RS-123456
        price:
          type: number
          format: float
          example: 79.99
          minimum: 0
        availableQuantity:
          type: integer
          example: 150
          minimum: 0
        categoryId:
          type: string
          format: uuid
          example: "b3d6917c-e021-4bcd-a27c-8f0d7f383ce9"
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - name
        - SKU
        - price
        - availableQuantity
        - categoryId

    ProductCreate:
      type: object
      properties:
        name:
          type: string
          example: Running Shoes
        description:
          type: string
        SKU:
          type: string
          example: RS-123456
        price:
          type: number
          format: float
          minimum: 0
        availableQuantity:
          type: integer
          minimum: 0
        categoryId:
          type: string
          format: uuid
      required:
        - name
        - SKU
        - price
        - availableQuantity
        - categoryId

    OrderItem:
      type: object
      properties:
        productId:
          type: string
          format: uuid
        quantity:
          type: integer
          minimum: 1
        price:
          type: number
          format: float
          minimum: 0
      required:
        - productId
        - quantity
        - price

    OrderBase:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
          readOnly: true
        customerId:
          type: string
          format: uuid
        orderItems:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        orderStatus:
          type: string
          enum: [pending, processing, shipped, delivered, cancelled]
          example: pending
        totalAmount:
          type: number
          format: float
          example: 159.98
          minimum: 0
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - customerId
        - orderItems
        - orderStatus
        - totalAmount

    OrderCreate:
      type: object
      properties:
        customerId:
          type: string
          format: uuid
        orderItems:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
      required:
        - customerId
        - orderItems

    OrderStatusUpdate:
      type: object
      properties:
        orderStatus:
          type: string
          enum: [pending, processing, shipped, delivered, cancelled]
      required:
        - orderStatus

    CustomerBase:
      type: object
      properties:
        customerId:
          type: string
          format: uuid
          readOnly: true
        name:
          type: string
          example: Acme Corp
        contactInfo:
          type: string
          example: contact@acme.com
        addresses:
          type: array
          items:
            type: string
          example:
            - "123 Main St, Anytown, USA"
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - name
        - contactInfo

    CustomerCreate:
      type: object
      properties:
        name:
          type: string
          example: Acme Corp
        contactInfo:
          type: string
          example: contact@acme.com
        addresses:
          type: array
          items:
            type: string
      required:
        - name
        - contactInfo

    ShipmentBase:
      type: object
      properties:
        shipmentId:
          type: string
          format: uuid
          readOnly: true
        orderId:
          type: string
          format: uuid
        shipmentStatus:
          type: string
          enum: [pending, shipped, in_transit, delivered, delayed]
          example: pending
        trackingNumber:
          type: string
          example: TRK123456789
        carrier:
          type: string
          example: UPS
        shippedDate:
          type: string
          format: date-time
          nullable: true
        estimatedDeliveryDate:
          type: string
          format: date-time
          nullable: true
        deliveryDate:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - orderId
        - shipmentStatus
        - trackingNumber
        - carrier

    ShipmentCreate:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
        shipmentStatus:
          type: string
          enum: [pending, shipped, in_transit, delivered, delayed]
          example: pending
        trackingNumber:
          type: string
        carrier:
          type: string
      required:
        - orderId
        - shipmentStatus
        - trackingNumber
        - carrier

    InventoryBase:
      type: object
      properties:
        inventoryId:
          type: string
          format: uuid
          readOnly: true
        productId:
          type: string
          format: uuid
        warehouseLocation:
          type: string
        quantityAvailable:
          type: integer
          minimum: 0
        lastUpdated:
          type: string
          format: date-time
          readOnly: true
      required:
        - productId
        - warehouseLocation
        - quantityAvailable

    InventoryUpdate:
      type: object
      properties:
        quantityAvailable:
          type: integer
          minimum: 0
      required:
        - quantityAvailable

    CategoryBase:
      type: object
      properties:
        categoryId:
          type: string
          format: uuid
          readOnly: true
        categoryName:
          type: string
          example: Footwear
        description:
          type: string
          example: Shoes and sandals
      required:
        - categoryName

    CategoryCreate:
      type: object
      properties:
        categoryName:
          type: string
          example: Footwear
        description:
          type: string
      required:
        - categoryName

paths:
  /auth/login:
    post:
      tags:
        - Auth
      summary: Authenticate user and obtain access and refresh tokens
      requestBody:
        description: User login credentials
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginRequest'
      responses:
        '200':
          description: Successful authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserLoginResponse'
              examples:
                example1:
                  value:
                    access_token: eyJhbGci...
                    refresh_token: xyz123...
                    token_type: bearer
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security: []
  
  /auth/logout:
    post:
      tags:
        - Auth
      summary: Logout user and invalidate refresh token
      security:
        - OAuth2PasswordBearer: []
      responses:
        '204':
          description: Logout successful with no content
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/refresh:
    post:
      tags:
        - Auth
      summary: Refresh access token using refresh token
      requestBody:
        description: Refresh token payload
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
              required:
                - refresh_token
      responses:
        '200':
          description: New access token returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  token_type:
                    type: string
                  refresh_token:
                    type: string
                required: [access_token, token_type, refresh_token]
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/register:
    post:
      tags:
        - Users
      summary: Register a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBase'
        '400':
          description: Validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/me:
    get:
      tags:
        - Users
      summary: Get profile information for authenticated user
      security:
        - OAuth2PasswordBearer: []
      responses:
        '200':
          description: User profile returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBase'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Users
      summary: Update profile information for authenticated user
      security:
        - OAuth2PasswordBearer: []
      requestBody:
        description: Fields to update (name, email, password)
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                  minLength: 8
      responses:
        '200':
          description: User profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBase'
        '400':
          description: Validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products:
    get:
      tags:
        - Products
      summary: List products with optional filtering and pagination
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - in: query
          name: name
          schema:
            type: string
          description: Filter by product name (partial match)
        - in: query
          name: SKU
          schema:
            type: string
          description: Filter by SKU
        - in: query
          name: categoryId
          schema:
            type: string
            format: uuid
          description: Filter by category ID
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Max number of results per page
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Offset for pagination
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    example: 150
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProductBase'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Products
      summary: Create a new product (Admin or Manager only)
      security:
        - OAuth2PasswordBearer: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '201':
          description: Product created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductBase'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden (insufficient role)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products/{productId}:
    get:
      tags:
        - Products
      summary: Get product details by ID
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Product details returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductBase'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Products
      summary: Update product details (Admin or Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                SKU:
                  type: string
                price:
                  type: number
                  minimum: 0
                availableQuantity:
                  type: integer
                  minimum: 0
                categoryId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductBase'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Products
      summary: Delete product by ID (Admin only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Product deleted successfully
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products/{productId}/image:
    post:
      tags:
        - Products
      summary: Upload image for a product (Admin or Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: productId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: JPG/PNG image file (max 5MB)
      responses:
        '201':
          description: Image uploaded successfully
        '400':
          description: Invalid file or size exceeds limit
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders:
    get:
      tags:
        - Orders
      summary: List orders (user sees own orders; Admin/Manager see all)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, processing, shipped, delivered, cancelled]
          description: Filter orders by status
        - in: query
          name: startDate
          schema:
            type: string
            format: date
          description: Filter orders created from this date (inclusive)
        - in: query
          name: endDate
          schema:
            type: string
            format: date
          description: Filter orders created until this date (inclusive)
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Results per page
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Pagination offset
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    example: 37
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderBase'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Orders
      summary: Place a new order (Customer only)
      security:
        - OAuth2PasswordBearer: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderCreate'
      responses:
        '201':
          description: Order placed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderBase'
        '400':
          description: Validation error or out-of-stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - e.g. ordering quantity exceeds inventory
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}:
    get:
      tags:
        - Orders
      summary: Get order details
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderBase'
        '403':
          description: Forbidden (customer trying to access others' orders)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/status:
    patch:
      tags:
        - Orders
      summary: Update order status (Admin or Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderStatusUpdate'
      responses:
        '200':
          description: Order status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderBase'
        '400':
          description: Invalid status transition or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/invoice:
    get:
      tags:
        - Orders
      summary: Download order invoice PDF
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: PDF Invoice file
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order or Invoice not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /customers:
    get:
      tags:
        - Customers
      summary: List customers (Admin/Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: List of customers
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    example: 50
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/CustomerBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Customers
      summary: Create new customer (Admin/Manager only)
      security:
        - OAuth2PasswordBearer: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerCreate'
      responses:
        '201':
          description: Customer created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerBase'
        '400':
          description: Validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /customers/{customerId}:
    get:
      tags:
        - Customers
      summary: Get customer details (Admin/Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Customer details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Customer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Customers
      summary: Update customer (Admin/Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                contactInfo:
                  type: string
                addresses:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Customer updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Customer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Customers
      summary: Delete customer (Admin only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Customer deleted successfully
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Customer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /shipments:
    get:
      tags:
        - Shipments
      summary: List shipments (Admin/Manager see all, Customer sees own orders shipments)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - in: query
          name: shipmentStatus
          schema:
            type: string
            enum: [pending, shipped, in_transit, delivered, delayed]
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: List of shipments
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ShipmentBase'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Shipments
      summary: Create a shipment record (Admin or Manager only)
      security:
        - OAuth2PasswordBearer: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShipmentCreate'
      responses:
        '201':
          description: Shipment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShipmentBase'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /shipments/{shipmentId}:
    get:
      tags:
        - Shipments
      summary: Get shipment details
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: shipmentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Shipment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShipmentBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Shipment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Shipments
      summary: Update shipment status or info (Admin or Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: shipmentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                shipmentStatus:
                  type: string
                  enum: [pending, shipped, in_transit, delivered, delayed]
                trackingNumber:
                  type: string
                carrier:
                  type: string
                shippedDate:
                  type: string
                  format: date-time
                estimatedDeliveryDate:
                  type: string
                  format: date-time
                deliveryDate:
                  type: string
                  format: date-time
      responses:
        '200':
          description: Shipment updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShipmentBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Shipment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory:
    get:
      tags:
        - Inventory
      summary: List inventory levels (Admin/Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - in: query
          name: productId
          schema:
            type: string
            format: uuid
        - in: query
          name: warehouseLocation
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Inventory list
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/InventoryBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/{inventoryId}:
    patch:
      tags:
        - Inventory
      summary: Update inventory quantity (Admin/Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: inventoryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InventoryUpdate'
      responses:
        '200':
          description: Inventory updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InventoryBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Inventory record not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /categories:
    get:
      tags:
        - Categories
      summary: List categories
      security:
        - OAuth2PasswordBearer: []
      responses:
        '200':
          description: List of product categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategoryBase'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Categories
      summary: Create a new product category (Admin or Manager only)
      security:
        - OAuth2PasswordBearer: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryCreate'
      responses:
        '201':
          description: Category created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /categories/{categoryId}:
    patch:
      tags:
        - Categories
      summary: Update product category (Admin or Manager only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                categoryName:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: Category updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoryBase'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Categories
      summary: Delete product category (Admin only)
      security:
        - OAuth2PasswordBearer: []
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Category deleted
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

security:
  - OAuth2PasswordBearer: []

x-rate-limiting:
  description: |
    The API applies rate limiting to protect against abuse.
    Clients are limited to 1000 requests per minute.
    Responses will use status code 429 Too Many Requests when limit is exceeded.

x-api-versioning:
  strategy: path-based
  description: |
    API versioning uses the URL path, e.g. /api/v1/.
    Future versions will increment the version number in the path.

x-error-handling:
  format: |
    {
      "error": {
        "code": "ERROR_CODE",
        "message": "Human readable message",
        "details": [
          {
            "field": "fieldname",
            "issue": "description"
          }
        ]
      }
    }

```
This OpenAPI 3.0 specification is complete, covering all entities, CRUD and business-specific operations, authentication and role-based authorization via OAuth2 password flow with JWT, consistent error response format with status codes, file upload endpoint, file download endpoint (PDF invoice), data validation rules, API versioning, rate limiting guidelines, and example data models matching the product requirements provided.

It is structured for immediate use in a FastAPI application, leveraging Pydantic-like schemas and security patterns typical of FastAPI, fully meeting the task criteria.

This completes the assignment.